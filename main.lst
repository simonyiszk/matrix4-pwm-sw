MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;******************************************************************************
                      00002 ;*                                                                            *
                      00003 ;*                                                                            *
                      00004 ;******************************************************************************
                      00005 ;
                      00006 ;
                      00007 ;-------------- Device data ---------------------------------------------------
                      00008 ;
                      00009 ;
                      00010                 list    p=PIC16f882, r=DEC
                      00011                 #include <p16f882.inc>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F882 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00779         LIST
                      00012                 #include "ft_macro.asm"
                      00001 #define         sz      btfss   STATUS,Z
                      00002 #define         snz     btfsc   STATUS,Z
                      00003 #define         sc      btfss   STATUS,C
                      00004 #define         snc     btfsc   STATUS,C
                      00005 #define         tstw    xorlw   0
                      00006 
                      00007 ;#define                setz    bsf     STATUS,Z,0
                      00008 ;#define                clrz    bcf     STATUS,Z,0
                      00009 ;#define                setc    bsf     STATUS,C,0
                      00010 ;#define                clrc    bcf     STATUS,C,0
                      00011 
                      00012 
                      00013 ;Error 207 - Found label after column 1
                      00014 
                      00015 byte    macro   nev,bank
                      00016         errorlevel -207
                      00017 
                      00018         if bank== 0
                      00019                 cblock  _RAM_B0
                      00020 nev     
                      00021                 endc
                      00022                 _RAM_B0++
                      00023         endif           
                      00024         if bank== 1
                      00025                 cblock  _RAM_B1
                      00026 nev     
                      00027                 endc
                      00028                 _RAM_B1++
                      00029         endif
                      00030         if bank== 2
                      00031                 cblock  _RAM_B2
                      00032 nev     
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00033                 endc
                      00034                 _RAM_B2++
                      00035         endif 
                      00036         if bank== 3
                      00037                 cblock  _RAM_B3
                      00038 nev     
                      00039                 endc
                      00040                 _RAM_B3++
                      00041         endif
                      00042         errorlevel +207
                      00043         endm
                      00044 
                      00045 word    macro   nev,bank
                      00046         errorlevel -207
                      00047 
                      00048         if bank== 0
                      00049                 cblock  _RAM_B0
                      00050 nev:2   
                      00051                 endc
                      00052                 _RAM_B0+=2
                      00053         endif           
                      00054         if bank== 1
                      00055                 cblock  _RAM_B1
                      00056 nev:2
                      00057                 endc
                      00058                 _RAM_B1+=2
                      00059         endif
                      00060         if bank== 2
                      00061                 cblock  _RAM_B2
                      00062 nev:2
                      00063                 endc
                      00064                 _RAM_B2+=2
                      00065         endif 
                      00066         if bank== 3
                      00067                 cblock  _RAM_B3
                      00068 nev:2
                      00069                 endc
                      00070                 _RAM_B3+=2
                      00071         endif
                      00072         errorlevel +207
                      00073         endm
                      00074 
                      00075 array   macro   nev,length,bank
                      00076         errorlevel -207
                      00077         if bank== 0
                      00078 
                      00079                 cblock  _RAM_B0
                      00080 nev:length
                      00081                 endc
                      00082                 _RAM_B0+=length
                      00083         endif           
                      00084         if bank== 1
                      00085                 cblock  _RAM_B1
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00086 nev:length
                      00087                 endc
                      00088                 _RAM_B1+=length
                      00089         endif
                      00090         if bank== 2
                      00091                 cblock  _RAM_B2
                      00092 nev:length
                      00093                 endc
                      00094                 _RAM_B2+=length
                      00095         endif 
                      00096         if bank== 3
                      00097                 cblock  _RAM_B3
                      00098 nev:length
                      00099                 endc
                      00100                 _RAM_B3+=length
                      00101         endif
                      00102         errorlevel +207
                      00103         endm
                      00104 
                      00105 
                      00106 
                      00107 
                      00108 
                      00109 
                      00110 
                      00111 TMR_DEC         macro   timer
                      00112         NOEXPAND
                      00113                 tstf  timer
                      00114                 sz
                      00115                 decf    timer,f
                      00116         EXPAND
                      00117                 endm
                      00118 
                      00119 
                      00120 TMR_DEC_FSR     macro   timer
                      00121         NOEXPAND
                      00122                 lfsr    FSR1,timer
                      00123                 tstfsz  INDF1
                      00124                 decf    INDF1,f
                      00125         EXPAND
                      00126                 endm
                      00127 
                      00128 
                      00129 SUB16   macro   Fa,Fb   ;Fa-Fb->Fa
                      00130         NOEXPAND
                      00131         errorlevel -302
                      00132         if high(Fb)!= 0
                      00133                 banksel Fb
                      00134         endif
                      00135                 movf    Fb,w
                      00136 
                      00137         if high(Fa)!=high(Fb)
                      00138                 banksel Fa
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00139         endif
                      00140                 subwf   Fa,f
                      00141                 sc
                      00142                 decf    Fa+1,f
                      00143 
                      00144         if high(Fa)!=high(Fb)
                      00145                 banksel Fb
                      00146         endif
                      00147                 movf    Fb+1,w
                      00148 
                      00149         if high(Fa)!=high(Fb)
                      00150                 banksel Fa
                      00151         endif
                      00152                 subwf   Fa+1,f
                      00153         if high(Fa)!= 0
                      00154                 banksel 0
                      00155         endif
                      00156         errorlevel +302
                      00157         EXPAND
                      00158         endm    
                      00159 
                      00160 
                      00161 bank0   macro
                      00162         NOEXPAND
                      00163                 bcf     STATUS,RP0
                      00164                 bcf     STATUS,RP1
                      00165         EXPAND
                      00166         endm
                      00167 bank1   macro   
                      00168         NOEXPAND
                      00169                 bsf     STATUS,RP0
                      00170                 bcf     STATUS,RP1
                      00171         EXPAND
                      00172         endm
                      00173 bank2   macro   
                      00174         NOEXPAND
                      00175                 bcf     STATUS,RP0
                      00176                 bsf     STATUS,RP1
                      00177         EXPAND
                      00178         endm
                      00179 bank3   macro   
                      00180         NOEXPAND
                      00181                 bsf     STATUS,RP0
                      00182                 bsf     STATUS,RP1
                      00183         EXPAND
                      00184         endm
                      00185 
                      00186 
                      00187 
                      00188 
                      00189 
                      00013 ;
                      00014 
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00015 ;------------------------------------------------------------------------------
                      00016 ;-------------- RAM PARAMÉTEREK -------------------------------------------
                      00017 ;------------------------------------------------------------------------------
  00000020            00018 RAM_B0_BEG      =       0x0020          ;Bank0 RAM inicializalasok kezdete
  0000006F            00019 RAM_B0_END      =       0x006F          ;Bank0 RAM inicializalasok vege
  000000A0            00020 RAM_B1_BEG      =       0x00A0          ;Bank1 RAM inicializalasok kezdete
  000000BF            00021 RAM_B1_END      =       0x00BF          ;Bank1 RAM inicializalasok vege
                      00022 
  0020                00023         variable        _RAM_B0=RAM_B0_BEG
  00A0                00024         variable        _RAM_B1=RAM_B1_BEG
                      00025 
                      00026 
                      00027 ;******************************************************************************
                      00028 ;*                                                                            *
                      00029 ;*                                                                            *
                      00030 ;*                                                                            *
                      00031 ;******************************************************************************
                      00032 ;-------------- IT rutinhoz szukseges mentesi regiszterek
                      00033         cblock 0x70     ; put these up in unbanked RAM
  00000070            00034 W_Save
  00000071            00035 STATUS_Save
  00000072            00036 PCLATH_Save
  00000073            00037 i_Save
  00000074            00038 j_Save
                      00039         endc
                      00040 
                      00041 
  0000009C            00042 SYSTEM_TIMER_10MS_INIT  =       156
  00000100            00043 TIMER0_CYCLE            =       256             ;Instruction cycle per Interrupt
  00000088            00044 TMR0_INIT               =       256- TIMER0_CYCLE/2 +8
                      00045 
                      00046         byte    SystemTimer10ms,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000020                M SystemTimer10ms 
                          M                 endc
  00000021                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M SystemTimer10ms 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M SystemTimer10ms 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                 cblock  _RAM_B3
                          M SystemTimer10ms 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00047         byte    i,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000021                M i       
                          M                 endc
  00000022                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M i       
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M i       
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M i       
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00048         byte    j,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000022                M j       
                          M                 endc
  00000023                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M j       
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M j       
                          M                 endc
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M j       
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00049 
                      00050 ;******************************************************************************
                      00051 ;*                                                                            *
                      00052 ;*              RESET                                                         *
                      00053 ;*                                                                            *
                      00054 ;******************************************************************************
                      00055 
0000                  00056                 org     0x0
0000   0000           00057                 nop
0001   0000           00058                 nop
0002   2996           00059                 goto    Start_Reset
                      00060 
                      00061 
                      00062 ;******************************************************************************
                      00063 ;*                                                                            *
                      00064 ;*              IT ADDRESS - IT ROUTINE                                       *
                      00065 ;*                                                                            *
                      00066 ;******************************************************************************
0004                  00067                 org     0x4
0004                  00068 ISR
0004   00F0           00069                 movwf   W_Save          ;Copy W to W_Save register
0005   0E03           00070                 swapf   STATUS,w        ;Swap status to be saved into W
                      00071                                         ;Swaps are used because they do not affect the status bits
0006   00F1           00072                 movwf   STATUS_Save     ;Save status to bank zero STATUS_Save register
                      00073 
0007   080A           00074                 movf    PCLATH,w        ;save PCLATH
0008   00F2           00075                 movwf   PCLATH_Save
                      00076 
0009   0821           00077                 movfw   i
000A   00F3           00078                 movwf   i_Save
000B   0822           00079                 movfw   j
000C   00F4           00080                 movwf   j_Save
                      00081 ;-----ISR------
                      00082                 bank0
                          M         EXPAND
                      00083 
000F   1D0B           00084                 btfss   INTCON,T0IF     ;TMR0 okozta az interruptot?
0010   2818           00085                 goto    IT_USART        ;nem
0011   110B           00086                 bcf     INTCON,T0IF     ;igen, clear TMR0 Interrupt flag
0012   3088           00087                 movlw   TMR0_INIT       ;init TMR0
0013   0081           00088                 movwf   TMR0
                      00089 ;---TIMER0      
                      00090                 TMR_DEC SystemTimer10ms ;decrement timer
                          M         EXPAND
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0017   2072           00091                 call    PWM_Control     ;PWM control
                      00092 
0018                  00093 IT_USART
0018   1A8C           00094                 btfsc   PIR1,RCIF       ;Usart-on jött adat?
0019   2102           00095                 call    USART_Recv      ;igen, feldolgozzuk
                      00096 
                      00097 ;-----ISR-END--
001A   0873           00098                 movfw   i_Save
001B   00A1           00099                 movwf   i
001C   0874           00100                 movfw   j_Save
001D   00A2           00101                 movwf   j
                      00102 
001E   0872           00103                 movf    PCLATH_Save,w   ;Restore PCLATH
001F   008A           00104                 movwf   PCLATH
                      00105 
0020   0E71           00106                 swapf   STATUS_Save,w   ;Swap STATUS_Save register into W
                      00107                                         ;(sets bank to original state)
0021   0083           00108                 movwf   STATUS          ;Move W into STATUS register
0022   0EF0           00109                 swapf   W_Save,f        ;Swap W_Save
0023   0E70           00110                 swapf   W_Save,w        ;Swap W_Save into W
0024   0009           00111                 retfie
                      00112 ;******************************************************************************
                      00113 ;*                                                                            *
                      00114 ;*              TABLES                                                *
                      00115 ;*                                                                            *
                      00116 ;******************************************************************************
0025                  00117 PWM_Szin_Table
0025   390F           00118                 andlw           0x0F
0026   0782           00119                 addwf           PCL,f
                      00120 
0027   342B           00121                 retlw           szint_r
0028   3433           00122                 retlw           szint_g
0029   343B           00123                 retlw           szint_b
002A   342B           00124                 retlw           szint_r
002B   3433           00125                 retlw           szint_g
002C   343B           00126                 retlw           szint_b
002D   342B           00127                 retlw           szint_r
002E   3433           00128                 retlw           szint_g
002F   343B           00129                 retlw           szint_b
0030   342B           00130                 retlw           szint_r
0031   3433           00131                 retlw           szint_g
0032   343B           00132                 retlw           szint_b
                      00133                 ;Nem szükséges, de nehogy túlfusson
0033   342B           00134                 retlw           szint_r
0034   342B           00135                 retlw           szint_r
0035   342B           00136                 retlw           szint_r
0036   342B           00137                 retlw           szint_r
                      00138 ;******************************************************************************
                      00139 ;*                                                                            *
                      00140 ;*              INCLUDES                                                      *
                      00141 ;*                                                                            *
                      00142 ;******************************************************************************
                      00143                 #include        "main.h"
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ; CONFIG1
                      00002 ; __config 0xEFFA
                      00003 ; __CONFIG _CONFIG1, _FOSC_HS & _WDTE_ON & _PWRTE_ON & _MCLRE_ON & _CP_OFF & _CPD_OFF & _BOREN_ON & _IES
                            O_ON & _FCMEN_ON & _LVP_OFF & _DEBUG_OFF
                      00004 ; CONFIG2
                      00005 ; __config 0xFEFF
                      00006 ; __CONFIG _CONFIG2, _BOR4V_BOR21V & _WRT_OFF
                      00007 
                      00008 
                      00009 
                      00010 ;---------------Enable/Disable Interrupts
                      00011 #define         EN_GLOBAL_IT            bsf     INTCON,GIE
                      00012 #define         DIS_GLOBAL_IT           bcf     INTCON,GIE
                      00013 
                      00014 #define         EN_PERIPH_IT            bsf     INTCON,PEIE
                      00015 #define         DIS_PERIPH_IT           bcf     INTCON,PEIE
                      00016 
                      00017 
                      00018 
                      00019 
  00000000            00020 OPTION_REG_INIT =       B'00000000'
                      00021 ;               bit 7 RBPU: PORTB Pull-up Enable bit
                      00022 ;                       1 = PORTB pull-ups are disabled
                      00023 ;               -->     0 = PORTB pull-ups are enabled by individual PORT latch values
                      00024 ;               bit 6 INTEDG: Interrupt Edge Select bit
                      00025 ;                       1 = Interrupt on rising edge of INT pin
                      00026 ;               -->     0 = Interrupt on falling edge of INT pin
                      00027 ;               bit 5 T0CS: TMR0 Clock Source Select bit
                      00028 ;                       1 = Transition on T0CKI pin
                      00029 ;               -->     0 = Internal instruction cycle clock (FOSC/4)
                      00030 ;               bit 4 T0SE: TMR0 Source Edge Select bit
                      00031 ;                       1 = Increment on high-to-low transition on T0CKI pin
                      00032 ;               -->     0 = Increment on low-to-high transition on T0CKI pin
                      00033 ;               bit 3 PSA: Prescaler Assignment bit
                      00034 ;                       1 = Prescaler is assigned to the WDT
                      00035 ;               -->     0 = Prescaler is assigned to the Timer0 module
                      00036 ;               bit 2-0 PS<2:0>: Prescaler Rate Select bits
                      00037 ;                       BIT VALUE       TMR0 RATE       WDT RATE
                      00038 ;               -->     000                     1 : 2           1 : 1   
                      00039 ;                       001                     1 : 4           1 : 2   
                      00040 ;                       010                     1 : 8           1 : 4   
                      00041 ;                       011                     1 : 16          1 : 8   
                      00042 ;                       100                     1 : 32          1 : 16  
                      00043 ;                       101                     1 : 64          1 : 32  
                      00044 ;                       110                     1 : 128         1 : 64  
                      00045 ;                       111                     1 : 256         1 : 128 
                      00046 
                      00047 
  00000015            00048 WDTCON_INIT     =       B'00010101'     ;enable, 1:32
                      00049 ;               bit 7-5 Unimplemented: Read as ‘0’
                      00050 ;               bit 4-1 WDTPS<3:0>: Watchdog Timer Period Select bits
                      00051 ;                       Bit Value       = Prescale Rate
                      00052 ;                       0000            = 1:32
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00053 ;                       0001            = 1:64
                      00054 ;                       0010            = 1:128
                      00055 ;                       0011            = 1:256
                      00056 ;                       0100            = 1:512 (Reset value)
                      00057 ;                       0101            = 1:1024
                      00058 ;                       0110            = 1:2048
                      00059 ;                       0111            = 1:4096
                      00060 ;                       1000            = 1:8192
                      00061 ;                       1001            = 1:16384
                      00062 ;               -->     1010            = 1:32768
                      00063 ;                       1011            = 1:65536
                      00064 ;                       1100            = reserved
                      00065 ;                       1101            = reserved
                      00066 ;                       1110            = reserved
                      00067 ;                       1111            = reserved
                      00068 ;               bit 0 SWDTEN: Software Enable or Disable the Watchdog Timer(1)
                      00069 ;               -->     1 = WDT is turned on
                      00070 ;                       0 = WDT is turned off (Reset value)
                      00071 
                      00072 
                      00073 
                      00074 
                      00075 
                      00076 
                      00144                 #include        "usart.h"
                      00001                 byte    RX_TMP,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000023                M RX_TMP  
                          M                 endc
  00000024                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M RX_TMP  
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M RX_TMP  
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M RX_TMP  
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00002                 byte    usart_rx_mode,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000024                M usart_rx_mode 
                          M                 endc
  00000025                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M usart_rx_mode 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M usart_rx_mode 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M usart_rx_mode 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00003                         ;0 - uninitialized, wait for receiving USART_INIT_MARKER
                      00004                         ;1 - normal mode
                      00005                 byte    usart_rx_id,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000025                M usart_rx_id 
                          M                 endc
  00000026                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M usart_rx_id 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M usart_rx_id 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M usart_rx_id 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00006                 byte    usart_rx_fenyero,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000026                M usart_rx_fenyero 
                          M                 endc
  00000027                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M usart_rx_fenyero 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M usart_rx_fenyero 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M usart_rx_fenyero 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00007                 byte    usart_rx_fenyero_tmp,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000027                M usart_rx_fenyero_tmp 
                          M                 endc
  00000028                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M usart_rx_fenyero_tmp 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M usart_rx_fenyero_tmp 
                          M                 endc
                          M                 _RAM_B2++
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M usart_rx_fenyero_tmp 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00008                 byte    usart_rx_ph_cnt,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000028                M usart_rx_ph_cnt 
                          M                 endc
  00000029                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M usart_rx_ph_cnt 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M usart_rx_ph_cnt 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M usart_rx_ph_cnt 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00009                 byte    fenyero_szin,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  00000029                M fenyero_szin 
                          M                 endc
  0000002A                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M fenyero_szin 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M fenyero_szin 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M fenyero_szin 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00010                 byte    usart_status,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  0000002A                M usart_status 
                          M                 endc
  0000002B                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M usart_status 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M usart_status 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M usart_status 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00011 
                      00012 
                      00013 #define         usart_sendVersion       usart_status,0
                      00014 #define         usart_sendAck           usart_status,1
                      00015 
  00000076            00016 VERSION_TEXT_1          =       'v'
  00000031            00017 VERSION_TEXT_2          =       '1'
  0000002E            00018 VERSION_TEXT_3          =       '.'
  00000030            00019 VERSION_TEXT_4          =       '0'
                      00020 
  000000F0            00021 USART_INIT_MARKER       =       0xF0
  000000F5            00022 USART_RX_ACK_MARKER     =       0xF5
  00000041            00023 USART_TX_ACK_BASE       =       'A'
  0000000E            00024 USART_CONFIG_MARKER     =       14
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00025 
                      00026 
  00000024            00027 TXSTA_INIT      =       B'00100100'
                      00028 ;               bit 7 CSRC: Clock Source Select bit
                      00029 ;                       Asynchronous mode:
                      00030 ;               -->             Don’t care
                      00031 ;                       Synchronous mode:
                      00032 ;                               1 = Master mode (clock generated internally from BRG)
                      00033 ;                               0 = Slave mode (clock from external source)
                      00034 ;               bit 6 TX9: 9-bit Transmit Enable bit
                      00035 ;                       1 = Selects 9-bit transmission
                      00036 ;               -->     0 = Selects 8-bit transmission
                      00037 ;               bit 5 TXEN: Transmit Enable bit(1)
                      00038 ;               -->     1 = Transmit enabled
                      00039 ;                       0 = Transmit disabled
                      00040 ;               bit 4 SYNC: EUSART Mode Select bit
                      00041 ;                       1 = Synchronous mode
                      00042 ;               -->     0 = Asynchronous mode
                      00043 ;               bit 3 SENDB: Send Break Character bit
                      00044 ;                       Asynchronous mode:
                      00045 ;                               1 = Send Sync Break on next transmission (cleared by hardware upon compl
                            etion)
                      00046 ;               -->             0 = Sync Break transmission completed
                      00047 ;                       Synchronous mode:
                      00048 ;                               Don’t care
                      00049 ;               bit 2 BRGH: High Baud Rate Select bit
                      00050 ;                       Asynchronous mode:
                      00051 ;               -->             1 = High speed
                      00052 ;                               0 = Low speed
                      00053 ;                       Synchronous mode:
                      00054 ;                               Unused in this mode
                      00055 ;               bit 1 TRMT: Transmit Shift Register Status bit
                      00056 ;                       1 = TSR empty
                      00057 ;               X       0 = TSR full
                      00058 ;               bit 0 TX9D: Ninth bit of Transmit Data
                      00059 ;               X       Can be address/data bit or a parity bit.
                      00060 
                      00061 
  00000090            00062 RCSTA_INIT      =       B'10010000'
                      00063 ;               bit 7 SPEN: Serial Port Enable bit
                      00064 ;               -->     1 = Serial port enabled (configures RX/DT and TX/CK pins as serial port pins)
                      00065 ;                       0 = Serial port disabled (held in Reset)
                      00066 ;               bit 6 RX9: 9-bit Receive Enable bit
                      00067 ;                       1 = Selects 9-bit reception
                      00068 ;               -->     0 = Selects 8-bit reception
                      00069 ;               bit 5 SREN: Single Receive Enable bit
                      00070 ;                       Asynchronous mode:
                      00071 ;               -->             Don’t care
                      00072 ;                       Synchronous mode – Master:
                      00073 ;                               1 = Enables single receive
                      00074 ;                               0 = Disables single receive
                      00075 ;                               This bit is cleared after reception is complete.
                      00076 ;                       Synchronous mode – Slave
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00077 ;                               Don’t care
                      00078 ;               bit 4 CREN: Continuous Receive Enable bit
                      00079 ;                       Asynchronous mode:
                      00080 ;               -->             1 = Enables receiver
                      00081 ;                               0 = Disables receiver
                      00082 ;                       Synchronous mode:
                      00083 ;                               1 = Enables continuous receive until enable bit CREN is cleared (CREN ov
                            errides SREN)
                      00084 ;                               0 = Disables continuous receive
                      00085 ;               bit 3 ADDEN: Address Detect Enable bit
                      00086 ;                       Asynchronous mode 9-bit (RX9 = 1):
                      00087 ;                               1 = Enables address detection, enable interrupt and load the receive buf
                            fer when RSR<8> is set
                      00088 ;                               0 = Disables address detection, all bytes are received and ninth bit can
                             be used as parity bit
                      00089 ;                       Asynchronous mode 8-bit (RX9 = 0):
                      00090 ;               -->             Don’t care
                      00091 ;               bit 2 FERR: Framing Error bit
                      00092 ;                       1 = Framing error (can be updated by reading RCREG register and receive next val
                            id byte)
                      00093 ;               X       0 = No framing error
                      00094 ;               bit 1 OERR: Overrun Error bit
                      00095 ;                       1 = Overrun error (can be cleared by clearing bit CREN)
                      00096 ;               X       0 = No overrun error
                      00097 ;               bit 0 RX9D: Ninth bit of Received Data
                      00098 ;               X       This can be address/data bit or a parity bit and must be calculated by user firm
                            ware.
                      00099 
                      00100 
  00000008            00101 BAUDCTL_INIT            =       B'00001000'
                      00102 ;               bit 7 ABDOVF: Auto-Baud Detect Overflow bit
                      00103 ;                       Asynchronous mode:
                      00104 ;                               1 = Auto-baud timer overflowed
                      00105 ;               X               0 = Auto-baud timer did not overflow
                      00106 ;                       Synchronous mode:
                      00107 ;                               Don’t care
                      00108 ;               bit 6 RCIDL: Receive Idle Flag bit
                      00109 ;                       Asynchronous mode:
                      00110 ;                               1 = Receiver is Idle
                      00111 ;               X               0 = Start bit has been received and the receiver is receiving
                      00112 ;                       Synchronous mode:
                      00113 ;                               Don’t care
                      00114 ;               bit 5 Unimplemented: Read as ‘0’
                      00115 ;               bit 4 SCKP: Synchronous Clock Polarity Select bit
                      00116 ;                       Asynchronous mode:
                      00117 ;                               1 = Transmit inverted data to the RB7/TX/CK pin
                      00118 ;               -->             0 = Transmit non-inverted data to the RB7/TX/CK pin
                      00119 ;                       Synchronous mode:
                      00120 ;                               1 = Data is clocked on rising edge of the clock
                      00121 ;                               0 = Data is clocked on falling edge of the clock
                      00122 ;               bit 3 BRG16: 16-bit Baud Rate Generator bit
                      00123 ;               -->     1 = 16-bit Baud Rate Generator is used
                      00124 ;                       0 = 8-bit Baud Rate Generator is used
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00125 ;               bit 2 Unimplemented: Read as ‘0’
                      00126 ;               bit 1 WUE: Wake-up Enable bit
                      00127 ;                       Asynchronous mode:
                      00128 ;                               1 = Receiver is waiting for a falling edge. No character will be receive
                            d byte RCIF will be set. WUE will
                      00129 ;                                       automatically clear after RCIF is set.
                      00130 ;               -->             0 = Receiver is operating normally
                      00131 ;                       Synchronous mode:
                      00132 ;                               Don’t care
                      00133 ;               bit 0 ABDEN: Auto-Baud Detect Enable bit
                      00134 ;                       Asynchronous mode:
                      00135 ;                               1 = Auto-Baud Detect mode is enabled (clears when auto-baud is complete)
                      00136 ;               -->             0 = Auto-Baud Detect mode is disabled
                      00137 ;                       Synchronous mode:
                      00138 ;                               Don’t care
                      00139 
                      00140 
  0000001F            00141 BAUD_REG_INIT   =       31
  0000001F            00142 SPBRG_INIT      =       LOW(BAUD_REG_INIT)
  00000000            00143 SPBRGH_INIT     =       HIGH(BAUD_REG_INIT)
                      00144 
                      00145 
                      00146 ; TODO
                      00147 ;       if (TXSTA_INIT & (1<<SYNC)) > 0
                      00148 ;               #define alma    0x12
                      00149 ;       else
                      00150 ;               #define alma    0x23
                      00151 ;       endif
                      00152 
                      00145                 #include        "PWM.h"
                      00001                 array   szint_r,8,0             ;pwm interval (EZ A SORREND MARAD!)
                          M         errorlevel -207
                          M         if 0==    0
                          M 
                          M                 cblock  _RAM_B0
  0000002B                M szint_r:8
                          M                 endc
  00000033                M                 _RAM_B0+=8
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M szint_r:8
                          M                 endc
                          M                 _RAM_B1+=8
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M szint_r:8
                          M                 endc
                          M                 _RAM_B2+=8
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M szint_r:8
                          M                 endc
                          M                 _RAM_B3+=8
                          M         endif
                          M         errorlevel +207
                      00002                 array   szint_g,8,0             ;pwm interval (EZ A SORREND MARAD!)
                          M         errorlevel -207
                          M         if 0==    0
                          M 
                          M                 cblock  _RAM_B0
  00000033                M szint_g:8
                          M                 endc
  0000003B                M                 _RAM_B0+=8
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M szint_g:8
                          M                 endc
                          M                 _RAM_B1+=8
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M szint_g:8
                          M                 endc
                          M                 _RAM_B2+=8
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M szint_g:8
                          M                 endc
                          M                 _RAM_B3+=8
                          M         endif
                          M         errorlevel +207
                      00003                 array   szint_b,8,0             ;pwm interval (EZ A SORREND MARAD!)
                          M         errorlevel -207
                          M         if 0==    0
                          M 
                          M                 cblock  _RAM_B0
  0000003B                M szint_b:8
                          M                 endc
  00000043                M                 _RAM_B0+=8
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M szint_b:8
                          M                 endc
                          M                 _RAM_B1+=8
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M szint_b:8
                          M                 endc
                          M                 _RAM_B2+=8
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M szint_b:8
                          M                 endc
                          M                 _RAM_B3+=8
                          M         endif
                          M         errorlevel +207
                      00004                 array   fenyero,12,0            ;6 bit pwm interval (rgb*4pixel)
                          M         errorlevel -207
                          M         if 0==    0
                          M 
                          M                 cblock  _RAM_B0
  00000043                M fenyero:12
                          M                 endc
  0000004F                M                 _RAM_B0+=12
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M fenyero:12
                          M                 endc
                          M                 _RAM_B1+=12
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M fenyero:12
                          M                 endc
                          M                 _RAM_B2+=12
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M fenyero:12
                          M                 endc
                          M                 _RAM_B3+=12
                          M         endif
                          M         errorlevel +207
                      00005                 array   fenyero_3bit,12,0       ;3 bit brightness (from mueb)
                          M         errorlevel -207
                          M         if 0==    0
                          M 
                          M                 cblock  _RAM_B0
  0000004F                M fenyero_3bit:12
                          M                 endc
  0000005B                M                 _RAM_B0+=12
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M fenyero_3bit:12
                          M                 endc
                          M                 _RAM_B1+=12
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M fenyero_3bit:12
                          M                 endc
                          M                 _RAM_B2+=12
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M fenyero_3bit:12
                          M                 endc
                          M                 _RAM_B3+=12
                          M         endif
                          M         errorlevel +207
                      00006                 byte    pwm_cnt,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  0000005B                M pwm_cnt 
                          M                 endc
  0000005C                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M pwm_cnt 
                          M                 endc
                          M                 _RAM_B1++
                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M pwm_cnt 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M pwm_cnt 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00007                 byte    pwm_cnt_shift,0
                          M         errorlevel -207
                          M 
                          M         if 0==    0
                          M                 cblock  _RAM_B0
  0000005C                M pwm_cnt_shift 
                          M                 endc
  0000005D                M                 _RAM_B0++
                          M         endif           
                          M         if 0==    1
                          M                 cblock  _RAM_B1
                          M pwm_cnt_shift 
                          M                 endc
                          M                 _RAM_B1++
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         if 0==    2
                          M                 cblock  _RAM_B2
                          M pwm_cnt_shift 
                          M                 endc
                          M                 _RAM_B2++
                          M         endif 
                          M         if 0==    3
                          M                 cblock  _RAM_B3
                          M pwm_cnt_shift 
                          M                 endc
                          M                 _RAM_B3++
                          M         endif
                          M         errorlevel +207
                      00008 
  00000010            00009 PWM_SHIFT       =       64/4
                      00010 
                      00011 #define         PORT_P0R        PORTA
                      00012 #define         PORT_P0G        PORTA
                      00013 #define         PORT_P0B        PORTA
                      00014 
                      00015 #define         PORT_P1R        PORTA
                      00016 #define         PORT_P1G        PORTA
                      00017 #define         PORT_P1B        PORTA
                      00018 
                      00019 #define         PORT_P2R        PORTC
                      00020 #define         PORT_P2G        PORTC
                      00021 #define         PORT_P2B        PORTC
                      00022 
                      00023 #define         PORT_P3R        PORTC
                      00024 #define         PORT_P3G        PORTC
                      00025 #define         PORT_P3B        PORTC
                      00026 
                      00027 #define         BIT_P0R         0
                      00028 #define         BIT_P0G         2
                      00029 #define         BIT_P0B         1
                      00030 
                      00031 #define         BIT_P1R         5
                      00032 #define         BIT_P1G         4
                      00033 #define         BIT_P1B         3
                      00034 
                      00035 #define         BIT_P2R         0
                      00036 #define         BIT_P2G         4
                      00037 #define         BIT_P2B         5
                      00038 
                      00039 #define         BIT_P3R         3
                      00040 #define         BIT_P3G         2
                      00041 #define         BIT_P3B         1
                      00042 
                      00043 
                      00044 
                      00146 ;------------------------------------------
                      00147                 #include        "PWM.asm"
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0037                  00001 Init_PWM_Control
0037   01C3           00002                 clrf    fenyero
0038   01C4           00003                 clrf    fenyero+1
0039   01C5           00004                 clrf    fenyero+2
003A   01C6           00005                 clrf    fenyero+3
003B   01C7           00006                 clrf    fenyero+4
003C   01C8           00007                 clrf    fenyero+5
003D   01C9           00008                 clrf    fenyero+6
003E   01CA           00009                 clrf    fenyero+7
003F   01CB           00010                 clrf    fenyero+8
0040   01CC           00011                 clrf    fenyero+9
0041   01CD           00012                 clrf    fenyero+10
0042   01CE           00013                 clrf    fenyero+11
                      00014 
0043   01CF           00015                 clrf    fenyero_3bit
0044   01D0           00016                 clrf    fenyero_3bit+1
0045   01D1           00017                 clrf    fenyero_3bit+2
0046   01D2           00018                 clrf    fenyero_3bit+3
0047   01D3           00019                 clrf    fenyero_3bit+4
0048   01D4           00020                 clrf    fenyero_3bit+5
0049   01D5           00021                 clrf    fenyero_3bit+6
004A   01D6           00022                 clrf    fenyero_3bit+7
004B   01D7           00023                 clrf    fenyero_3bit+8
004C   01D8           00024                 clrf    fenyero_3bit+9
004D   01D9           00025                 clrf    fenyero_3bit+10
004E   01DA           00026                 clrf    fenyero_3bit+11
                      00027 
004F   3000           00028                 movlw   0x00
0050   00AB           00029                 movwf   szint_r
0051   00B3           00030                 movwf   szint_g
0052   00BB           00031                 movwf   szint_b
0053   3001           00032                 movlw   0x01
0054   00AC           00033                 movwf   szint_r+1
0055   00B4           00034                 movwf   szint_g+1
0056   00BC           00035                 movwf   szint_b+1
0057   3002           00036                 movlw   0x02
0058   00AD           00037                 movwf   szint_r+2
0059   00B5           00038                 movwf   szint_g+2
005A   00BD           00039                 movwf   szint_b+2
005B   3004           00040                 movlw   0x04
005C   00AE           00041                 movwf   szint_r+3
005D   00B6           00042                 movwf   szint_g+3
005E   00BE           00043                 movwf   szint_b+3
005F   3008           00044                 movlw   0x08
0060   00AF           00045                 movwf   szint_r+4
0061   00B7           00046                 movwf   szint_g+4
0062   00BF           00047                 movwf   szint_b+4
0063   3010           00048                 movlw   0x10
0064   00B0           00049                 movwf   szint_r+5
0065   00B8           00050                 movwf   szint_g+5
0066   00C0           00051                 movwf   szint_b+5
0067   3020           00052                 movlw   0x20
0068   00B1           00053                 movwf   szint_r+6
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0069   00B9           00054                 movwf   szint_g+6
006A   00C1           00055                 movwf   szint_b+6
006B   3040           00056                 movlw   0x40
006C   00B2           00057                 movwf   szint_r+7
006D   00BA           00058                 movwf   szint_g+7
006E   00C2           00059                 movwf   szint_b+7
                      00060                         
006F   01DB           00061                 clrf    pwm_cnt
0070   01DC           00062                 clrf    pwm_cnt_shift
                      00063 
0071   0008           00064                 return
                      00065 ;-------------------------------------------------------------------------------
0072                  00066 PWM_Control
0072   0000           00067                 nop
0073   085B           00068                 movfw   pwm_cnt         ;pwm_cnt másolása a pwm_cnt_shift-be
0074   00DC           00069                 movwf   pwm_cnt_shift
                      00070 
0075   1383           00071                 bcf     STATUS,IRP              ;bank0 indirect
0076   3043           00072                 movlw   fenyero                 ;INDF->fenyero[0]
0077   0084           00073                 movwf   FSR
                      00074 
                      00075 ;---Pixel-0-Red
0078   0800           00076                 movfw   INDF
0079   025C           00077                 subwf   pwm_cnt_shift,w         ;cnt - feny[0]
007A   1C03           00078                 sc
007B   1405           00079                 bsf     PORT_P0R,BIT_P0R        ;C=0 (feny[0] > cnt)
007C   1803           00080                 snc
007D   1005           00081                 bcf     PORT_P0R,BIT_P0R        ;C=1 (feny[0] <= cnt)
007E   0A84           00082                 incf    FSR,f                   ;INDF->fenyero[1]
                      00083 ;---Pixel-0-Green
007F   0800           00084                 movfw   INDF
0080   025C           00085                 subwf   pwm_cnt_shift,w         ;cnt - feny[1]
0081   1C03           00086                 sc
0082   1505           00087                 bsf     PORT_P0G,BIT_P0G        ;C=0 (feny[1] > cnt)
0083   1803           00088                 snc
0084   1105           00089                 bcf     PORT_P0G,BIT_P0G        ;C=1 (feny[1] <= cnt)
0085   0A84           00090                 incf    FSR,f                   ;INDF->fenyero[2]
                      00091 ;---Pixel-0-Blue
0086   0800           00092                 movfw   INDF
0087   025C           00093                 subwf   pwm_cnt_shift,w         ;cnt - feny[2]
0088   1C03           00094                 sc
0089   1485           00095                 bsf     PORT_P0B,BIT_P0B        ;C=0 (feny[2] > cnt)
008A   1803           00096                 snc
008B   1085           00097                 bcf     PORT_P0B,BIT_P0B        ;C=1 (feny[2] <= cnt)
008C   0A84           00098                 incf    FSR,f                   ;INDF->fenyero[3]
008D   3010           00099                 movlw   PWM_SHIFT               ;PWM counter igaítás (eltolva kapcsolgatjuk a paneleket)
008E   02DC           00100                 subwf   pwm_cnt_shift,f
008F   303F           00101                 movlw   0x3F
0090   05DC           00102                 andwf   pwm_cnt_shift,f
                      00103 
                      00104 ;---Pixel-1-Red         (Pontosan ugyanaz mint feljebb, csak másik panelre)
0091   0800           00105                 movfw   INDF
0092   025C           00106                 subwf   pwm_cnt_shift,w
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0093   1C03           00107                 sc
0094   1685           00108                 bsf     PORT_P1R,BIT_P1R
0095   1803           00109                 snc
0096   1285           00110                 bcf     PORT_P1R,BIT_P1R
0097   0A84           00111                 incf    FSR,f
                      00112 ;---Pixel-1-Green       (Pontosan ugyanaz mint feljebb, csak másik panelre)
0098   0800           00113                 movfw   INDF
0099   025C           00114                 subwf   pwm_cnt_shift,w
009A   1C03           00115                 sc
009B   1605           00116                 bsf     PORT_P1G,BIT_P1G
009C   1803           00117                 snc
009D   1205           00118                 bcf     PORT_P1G,BIT_P1G
009E   0A84           00119                 incf    FSR,f
                      00120 ;---Pixel-1-Blue        (Pontosan ugyanaz mint feljebb, csak másik panelre)
009F   0800           00121                 movfw   INDF
00A0   025C           00122                 subwf   pwm_cnt_shift,w
00A1   1C03           00123                 sc
00A2   1585           00124                 bsf     PORT_P1B,BIT_P1B
00A3   1803           00125                 snc
00A4   1185           00126                 bcf     PORT_P1B,BIT_P1B
00A5   0A84           00127                 incf    FSR,f
00A6   3010           00128                 movlw   PWM_SHIFT
00A7   02DC           00129                 subwf   pwm_cnt_shift,f
00A8   303F           00130                 movlw   0x3F
00A9   05DC           00131                 andwf   pwm_cnt_shift,f
                      00132 
                      00133 ;---Pixel-2-Red         (Pontosan ugyanaz mint feljebb, csak másik panelre)
00AA   0800           00134                 movfw   INDF
00AB   025C           00135                 subwf   pwm_cnt_shift,w
00AC   1C03           00136                 sc
00AD   1407           00137                 bsf     PORT_P2R,BIT_P2R
00AE   1803           00138                 snc
00AF   1007           00139                 bcf     PORT_P2R,BIT_P2R
00B0   0A84           00140                 incf    FSR,f
                      00141 ;---Pixel-2-Green       (Pontosan ugyanaz mint feljebb, csak másik panelre)
00B1   0800           00142                 movfw   INDF
00B2   025C           00143                 subwf   pwm_cnt_shift,w
00B3   1C03           00144                 sc
00B4   1607           00145                 bsf     PORT_P2G,BIT_P2G
00B5   1803           00146                 snc
00B6   1207           00147                 bcf     PORT_P2G,BIT_P2G
00B7   0A84           00148                 incf    FSR,f
                      00149 ;---Pixel-2-Blue        (Pontosan ugyanaz mint feljebb, csak másik panelre)
00B8   0800           00150                 movfw   INDF
00B9   025C           00151                 subwf   pwm_cnt_shift,w
00BA   1C03           00152                 sc
00BB   1687           00153                 bsf     PORT_P2B,BIT_P2B
00BC   1803           00154                 snc
00BD   1287           00155                 bcf     PORT_P2B,BIT_P2B
00BE   0A84           00156                 incf    FSR,f
00BF   3010           00157                 movlw   PWM_SHIFT
00C0   02DC           00158                 subwf   pwm_cnt_shift,f
00C1   303F           00159                 movlw   0x3F
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00C2   05DC           00160                 andwf   pwm_cnt_shift,f
                      00161 
                      00162 ;---Pixel-3-Red         (Pontosan ugyanaz mint feljebb, csak másik panelre)
00C3   0800           00163                 movfw   INDF
00C4   025C           00164                 subwf   pwm_cnt_shift,w
00C5   1C03           00165                 sc
00C6   1587           00166                 bsf     PORT_P3R,BIT_P3R
00C7   1803           00167                 snc
00C8   1187           00168                 bcf     PORT_P3R,BIT_P3R
00C9   0A84           00169                 incf    FSR,f
                      00170 ;---Pixel-3-Green       (Pontosan ugyanaz mint feljebb, csak másik panelre)
00CA   0800           00171                 movfw   INDF
00CB   025C           00172                 subwf   pwm_cnt_shift,w
00CC   1C03           00173                 sc
00CD   1507           00174                 bsf     PORT_P3G,BIT_P3G
00CE   1803           00175                 snc
00CF   1107           00176                 bcf     PORT_P3G,BIT_P3G
00D0   0A84           00177                 incf    FSR,f
                      00178 ;---Pixel-3-Blue        (Pontosan ugyanaz mint feljebb, csak másik panelre)
00D1   0800           00179                 movfw   INDF
00D2   025C           00180                 subwf   pwm_cnt_shift,w
00D3   1C03           00181                 sc
00D4   1487           00182                 bsf     PORT_P3B,BIT_P3B
00D5   1803           00183                 snc
00D6   1087           00184                 bcf     PORT_P3B,BIT_P3B
00D7   0A84           00185                 incf    FSR,f
00D8   3010           00186                 movlw   PWM_SHIFT
00D9   02DC           00187                 subwf   pwm_cnt_shift,f
00DA   303F           00188                 movlw   0x3F
00DB   05DC           00189                 andwf   pwm_cnt_shift,f
                      00190 
00DC   0ADB           00191                 incf    pwm_cnt,f
00DD   1B5B           00192                 btfsc   pwm_cnt,6
00DE   01DB           00193                 clrf    pwm_cnt
00DF   0008           00194                 return
                      00195 
                      00196 
                      00197 
                      00198 
                      00199 
                      00200 
                      00201 
                      00202 
                      00203 
                      00148                 #include        "usart.asm"
                      00001 
00E0                  00002 USART_Init ;(see usart.h)
00E0   1683 1303      00003                 BANKSEL TXSTA
00E2   3024           00004                 movlw   TXSTA_INIT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00E3   0098           00005                 movwf   TXSTA
00E4   1283 1303      00006                 BANKSEL RCSTA
00E6   3090           00007                 movlw   RCSTA_INIT
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00E7   0098           00008                 movwf   RCSTA
00E8   1683 1703      00009                 BANKSEL BAUDCTL
00EA   3008           00010                 movlw   BAUDCTL_INIT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00EB   0087           00011                 movwf   BAUDCTL
00EC   1683 1303      00012                 BANKSEL SPBRG
00EE   301F           00013                 movlw   SPBRG_INIT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00EF   0099           00014                 movwf   SPBRG
00F0   1683 1303      00015                 BANKSEL SPBRGH
00F2   3000           00016                 movlw   SPBRGH_INIT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00F3   009A           00017                 movwf   SPBRGH
                      00018                 ;RC7-RX and RC6-TX
00F4   1683 1303      00019                 BANKSEL PIE1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00F6   128C           00020                 bcf     PIE1,RCIE       ;enable RX interrupt
                      00021 
                      00022                 bank0
                          M         EXPAND
00F9   01A3           00023                 clrf    RX_TMP
00FA   01A4           00024                 clrf    usart_rx_mode
00FB   01A5           00025                 clrf    usart_rx_id
00FC   01A6           00026                 clrf    usart_rx_fenyero
00FD   01A7           00027                 clrf    usart_rx_fenyero_tmp
00FE   01A8           00028                 clrf    usart_rx_ph_cnt
00FF   01A9           00029                 clrf    fenyero_szin
0100   01AA           00030                 clrf    usart_status
0101   0008           00031                 return
                      00032 
0102                  00033 USART_Recv
0102   081A           00034                 movfw   RCREG           ;Read uart buffer
0103   00A3           00035                 movwf   RX_TMP          ;store in temp register
                      00036 
0104   3907           00037                 andlw   0x07
0105   00A6           00038                 movwf   usart_rx_fenyero;alsó 3 bit: fenyero
0106   0E23           00039                 swapf   RX_TMP,w
0107   390F           00040                 andlw   0x0F
0108   00A5           00041                 movwf   usart_rx_id     ;felsõ 4 bit: id
                      00042 
0109   30F5           00043                 movlw   USART_RX_ACK_MARKER
010A   0623           00044                 xorwf   RX_TMP,w
010B   1D03           00045                 sz
010C   290F           00046                 goto    USART_Recv_Modes
010D   14AA           00047                 bsf     usart_sendAck   
010E   0008           00048                 return
                      00049 
                      00050 ;switch (usart_rx_mode)
010F                  00051 USART_Recv_Modes
010F   3000           00052                 movlw   0
0110   0624           00053                 xorwf   usart_rx_mode,w
0111   1903           00054                 snz
0112   291D           00055                 goto    USART_Mode_0    ;case 0: uninitialized
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0113   3001           00056                 movlw   1
0114   0624           00057                 xorwf   usart_rx_mode,w
0115   1903           00058                 snz
0116   2925           00059                 goto    USART_Mode_1    ;case 1: normal mode
0117   3002           00060                 movlw   2
0118   0624           00061                 xorwf   usart_rx_mode,w
0119   1903           00062                 snz
011A   2943           00063                 goto    USART_Mode_2
                      00064 
011B   01A4           00065                 clrf    usart_rx_mode
011C   0008           00066                 return
                      00067 ;---------------
011D                  00068 USART_Mode_0
011D   30F0           00069                 movlw   USART_INIT_MARKER
011E   0623           00070                 xorwf   RX_TMP,w
011F   1D03           00071                 sz
0120   0008           00072                 return
0121   142A           00073                 bsf     usart_sendVersion
0122   3001           00074                 movlw   1
0123   00A4           00075                 movwf   usart_rx_mode
0124   0008           00076                 return
                      00077 ;---------------
0125                  00078 USART_Mode_1
0125   300E           00079                 movlw   USART_CONFIG_MARKER
0126   0625           00080                 xorwf   usart_rx_id,w
0127   1903           00081                 snz
0128   292E           00082                 goto    USART_Mode_1_ToConfig   ;usart_rx_id = 14
                      00083 
0129   300C           00084                 movlw   12
012A   0225           00085                 subwf   usart_rx_id,w
012B   1C03           00086                 sc
012C   2932           00087                 goto    USART_Mode_1_Fenyero    ;usart_rx_id < 12
012D   0008           00088                 return
                      00089 ;-----
012E                  00090 USART_Mode_1_ToConfig
012E   3002           00091                 movlw   2
012F   00A4           00092                 movwf   usart_rx_mode           ;move to config mode
0130   01A8           00093                 clrf    usart_rx_ph_cnt
0131   0008           00094                 return
                      00095 ;-----
0132                  00096 USART_Mode_1_Fenyero
0132   0825           00097                 movfw   usart_rx_id             ;fenyero_szin: szint_r v szint_g v szint_b
0133   2025           00098                 call    PWM_Szin_Table
                      00099 
0134   0726           00100                 addwf   usart_rx_fenyero,w
0135   0084           00101                 movwf   FSR
0136   0800           00102                 movfw   INDF
0137   00A7           00103                 movwf   usart_rx_fenyero_tmp    ;itt van a tényleges pwm fényerõ
                      00104 
0138   3043           00105                 movlw   fenyero
0139   0725           00106                 addwf   usart_rx_id,w
013A   0084           00107                 movwf   FSR
013B   0827           00108                 movfw   usart_rx_fenyero_tmp
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

013C   0080           00109                 movwf   INDF                    ;fenyero-be tesszük az intervallumot (0x00-0x3F)
                      00110 
013D   304F           00111                 movlw   fenyero_3bit
013E   0725           00112                 addwf   usart_rx_id,w
013F   0084           00113                 movwf   FSR
0140   0826           00114                 movfw   usart_rx_fenyero
0141   0080           00115                 movwf   INDF                    ;fenyero_3bit-be tesszük a fényességet (0x00-0x07)
                      00116 
0142   0008           00117                 return
                      00118 ;---------------
0143                  00119 USART_Mode_2
0143   300F           00120                 movlw   15
0144   0625           00121                 xorwf   usart_rx_id,w   ;usart_rx_id = 15?
0145   1903           00122                 snz
0146   2954           00123                 goto    USART_Mode_2_To1;igen, vissza normál módba
                      00124 
0147   302B           00125                 movlw   szint_r         ;usart_rx_ph_cnt < 24
0148   0084           00126                 movwf   FSR             ;load szint_r
0149   0828           00127                 movfw   usart_rx_ph_cnt
014A   0784           00128                 addwf   FSR,f           ;select szint_r[usart_rx_ph_cnt]
014B   0823           00129                 movfw   RX_TMP
014C   397F           00130                 andlw   0x7F
014D   0080           00131                 movwf   INDF            ;szint_r[usart_rx_ph_cnt] = Received byte
                      00132 
014E   0AA8           00133                 incf    usart_rx_ph_cnt,f
014F   3018           00134                 movlw   24
0150   0228           00135                 subwf   usart_rx_ph_cnt,w
0151   1803           00136                 snc
0152   2954           00137                 goto    USART_Mode_2_To1 ;usart_rx_ph_cnt >= 24 -> mode to 1
                      00138 
0153   0008           00139                 return
                      00140 ;-----
0154                  00141 USART_Mode_2_To1
0154   3001           00142                 movlw   1
0155   00A4           00143                 movwf   usart_rx_mode
0156   2958           00144                 goto    USART_Mode_2_UpdatePWMIntervals
0157   0008           00145                 return
                      00146 
                      00147 
0158                  00148 USART_Mode_2_UpdatePWMIntervals
                      00149                 ;fenyero[i] = szint[fenyero_3bit[i]]
0158   3000           00150                 movlw   0
0159   00A1           00151                 movwf   i
                      00152 
015A                  00153 USART_Mode_2_UPWMI_cycle
015A   304F           00154                 movlw   fenyero_3bit
015B   0721           00155                 addwf   i,w
015C   0084           00156                 movwf   FSR
                      00157 
015D   0821           00158                 movfw   i               ;fenyero_szin: szint_r v szint_g v szint_b
015E   2025           00159                 call    PWM_Szin_Table
015F   0700           00160                 addwf   INDF,w
0160   0084           00161                 movwf   FSR
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0161   0800           00162                 movfw   INDF
0162   00A2           00163                 movwf   j
                      00164                 
0163   3043           00165                 movlw   fenyero
0164   0721           00166                 addwf   i,w
0165   0084           00167                 movwf   FSR
0166   0822           00168                 movfw   j
0167   0080           00169                 movwf   INDF
                      00170 
0168   0AA1           00171                 incf    i,f
0169   300C           00172                 movlw   12
016A   0221           00173                 subwf   i,w
016B   1C03           00174                 sc
016C   295A           00175                 goto    USART_Mode_2_UPWMI_cycle
                      00176 
016D   0008           00177                 return
                      00178 
                      00179 ;--------------------------------------------------------------------------------
                      00180 
016E                  00181 USART_Task
016E   1E0C           00182                 btfss   PIR1,TXIF
016F   0008           00183                 return
0170   182A           00184                 btfsc   usart_sendVersion
0171   2975           00185                 goto    USART_Task_Ver
0172   18AA           00186                 btfsc   usart_sendAck
0173   2991           00187                 goto    USART_Task_Ack
0174   0008           00188                 return
                      00189 
0175                  00190 USART_Task_Ver
0175   102A           00191                 bcf     usart_sendVersion
0176   3000           00192                 movlw   0
0177   21CE           00193                 call    EE_Read_Data
0178   0099           00194                 movwf   TXREG
0179   0000           00195                 nop
017A   0000           00196                 nop
017B                  00197 USART_Task_Ver1
017B   1E0C           00198                 btfss   PIR1,TXIF
017C   297B           00199                 goto    USART_Task_Ver1
017D   3001           00200                 movlw   1
017E   21CE           00201                 call    EE_Read_Data
017F   0099           00202                 movwf   TXREG
0180   0000           00203                 nop
0181   0000           00204                 nop
0182                  00205 USART_Task_Ver2
0182   1E0C           00206                 btfss   PIR1,TXIF
0183   2982           00207                 goto    USART_Task_Ver2
0184   3002           00208                 movlw   2
0185   21CE           00209                 call    EE_Read_Data
0186   0099           00210                 movwf   TXREG
0187   0000           00211                 nop
0188   0000           00212                 nop
0189                  00213 USART_Task_Ver3
0189   1E0C           00214                 btfss   PIR1,TXIF
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

018A   2989           00215                 goto    USART_Task_Ver3
018B   3003           00216                 movlw   3
018C   21CE           00217                 call    EE_Read_Data
018D   0099           00218                 movwf   TXREG
018E   0000           00219                 nop
018F   0000           00220                 nop
0190   0008           00221                 return
                      00222 
0191                  00223 USART_Task_Ack
0191   10AA           00224                 bcf     usart_sendAck
0192   3041           00225                 movlw   USART_TX_ACK_BASE
0193   0724           00226                 addwf   usart_rx_mode,w
0194   0099           00227                 movwf   TXREG
0195   0008           00228                 return
                      00229 
                      00230 
                      00149 ;******************************************************************************
                      00150 ;*                                                                            *
                      00151 ;*              INITIALIZING PERIPHERALS                                      *
                      00152 ;*                                                                            *
                      00153 ;******************************************************************************
0196                  00154 Start_Reset
0196   0064           00155                 clrwdt
                      00156 
0197   1283 1303      00157                 BANKSEL PORTA   ;select bank
0199   0185           00158                 clrf    PORTA   ;clear all ports
019A   0186           00159                 clrf    PORTB
019B   0187           00160                 clrf    PORTC
                      00161 
019C   1683 1303      00162                 BANKSEL TRISA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
019E   0185           00163                 clrf    TRISA   ;output
019F   30FF           00164                 movlw   0xFF
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01A0   0086           00165                 movwf   TRISB   ;input
01A1   3080           00166                 movlw   0x80
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01A2   0087           00167                 movwf   TRISC   ;output (except RC7 -> USART RX, but RCSTA,SPEN configs that)
                      00168 
01A3   1683 1703      00169                 BANKSEL ANSEL   ;analóg: nem kell semmi
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01A5   0188           00170                 clrf    ANSEL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01A6   0189           00171                 clrf    ANSELH
                      00172 
01A7   1683 1303      00173                 BANKSEL OPTION_REG
01A9   3000           00174                 movlw   OPTION_REG_INIT ;see main.h
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01AA   0081           00175                 movwf   OPTION_REG
                      00176 
                      00177 #ifndef __DEBUG ;Debug-ban nincs watchdog
                      00178                 BANKSEL WDTCON          ;Watchdog init
                      00179                 movlw   WDTCON_INIT
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00180                 movwf   WDTCON
                      00181 #endif
01AB   1283 1303      00182                 BANKSEL TMR0
01AD   3088           00183                 movlw   TMR0_INIT       ;Timer0 init
01AE   0081           00184                 movwf   TMR0
01AF   110B           00185                 bcf     INTCON,T0IF     ;Clear Timer0 IT flag
01B0   168B           00186                 bsf     INTCON,T0IE     ;Enable Timer0 Interrupt
                      00187 
                      00188 
                      00189                 bank0
                          M         EXPAND
                      00190 ;-------------- GENERAL INITS
01B3   01A0           00191                 clrf    SystemTimer10ms
                      00192 
01B4   20E0           00193                 call    USART_Init
01B5   2037           00194                 call    Init_PWM_Control
                      00195 ;--------------
                      00196 
01B6   170B           00197                 EN_PERIPH_IT    ;Enable peripheral interrupts
01B7   178B           00198                 EN_GLOBAL_IT    ;Enable global interrupts
                      00199 
01B8   29B9           00200                 goto    Main_Loop
                      00201 
                      00202 
                      00203 ;******************************************************************************
                      00204 ;*                                                                            *
                      00205 ;*              MAIN PROGRAM LOOP                                             *
                      00206 ;*                                                                            *
                      00207 ;******************************************************************************
01B9                  00208 Main_Loop
01B9   0064           00209                 clrwdt          ;clear watchdog timer
                      00210 
01BA   08A0           00211                 tstf    SystemTimer10ms ;timer lejárt?
01BB   1D03           00212                 sz
01BC   29C9           00213                 goto    Main_Loop_end           ;nope, nincs tennivaló
01BD   309C           00214                 movlw   SYSTEM_TIMER_10MS_INIT  ;igen, timer init
01BE   00A0           00215                 movwf   SystemTimer10ms
                      00216 
                      00217 ;-------------- BEGIN 100ms tasks
01BF   3000           00218                 movlw   0
01C0   0624           00219                 xorwf   usart_rx_mode,w
01C1   1D03           00220                 sz
01C2   29C9           00221                 goto    Main_Loop_end
01C3   0000           00222                 nop
01C4   3055           00223                 movlw   0x55
01C5   1E0C           00224                 btfss   PIR1,TXIF
01C6   29C9           00225                 goto    Main_Loop_end
01C7   0099           00226                 movwf   TXREG
01C8   0000           00227                 nop
                      00228 ;-------------- END 100ms
                      00229 
01C9                  00230 Main_Loop_end
                      00231                 bank0
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         EXPAND
01CB   216E           00232                 call    USART_Task
                      00233 
01CC   29B9           00234                 goto    Main_Loop
01CD   29B9           00235                 goto    Main_Loop
                      00236 ;******************************************************************************
                      00237 ;*                                                                            *
                      00238 ;*              READ EEPROM DATA                                              *
                      00239 ;*                                                                            *
                      00240 ;******************************************************************************
                      00241         ;parameter: WREG
01CE                  00242 EE_Read_Data
01CE   1283 1703      00243                 BANKSEL EEADR           ;
                      00244 ;               MOVLW   DATA_EE_ADDR    ;
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01D0   008D           00245                 MOVWF   EEADR           ;Data Memory
                      00246                                         ;Address to read
01D1   1683 1703      00247                 BANKSEL EECON1          ;
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01D3   138C           00248                 BCF     EECON1,EEPGD    ;Point to DATA memory
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01D4   140C           00249                 BSF     EECON1,RD       ;EE Read
01D5   1283 1703      00250                 BANKSEL EEDAT           ;
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
01D7   080C           00251                 MOVF    EEDAT,W         ;W = EEDAT
                      00252                 bank0
                          M         EXPAND
01DA   0008           00253                 RETURN
                      00254 
2100                  00255                 org     0x2100
2100                  00256 EE_VERSION_ADDR
2100   0076 0031 002E 00257                 de      "v1.0"
       0030 
                      00258 
                      00259 
                      00260 
                      00261 
                      00262 ;******************************************************************************
                      00263 ;*   CHECK RAM USAGE                                                          *
                      00264 ;******************************************************************************
                      00265         if _RAM_B0>RAM_B0_END
                      00266                 error    "Az BANK0-ba szánt változók nem férnek el!!!!"
                      00267         endif
Message[301]: MESSAGE: (Bank0 regs: 61/79)
                      00268         messg   Bank0 regs: 61/79
                      00269 
                      00270         if _RAM_B1>RAM_B1_END
                      00271                 error    "Az BANK1-ba szánt változók nem férnek el!!!!"
                      00272         endif
Message[301]: MESSAGE: (Bank1 regs: 0/31)
                      00273         messg   Bank1 regs: 0/31
                      00274 
                      00275         end
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 33


SYMBOL TABLE
  LABEL                             VALUE 

ABDEN                             00000000
ABDOVF                            00000007
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ANS0                              00000000
ANS1                              00000001
ANS10                             00000002
ANS11                             00000003
ANS12                             00000004
ANS13                             00000005
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS8                              00000000
ANS9                              00000001
ANSEL                             00000188
ANSELH                            00000189
BAUDCTL                           00000187
BAUDCTL_INIT                      00000008
BAUD_REG_INIT                     0000001F
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BIT_P0B                           1
BIT_P0G                           2
BIT_P0R                           0
BIT_P1B                           3
BIT_P1G                           4
BIT_P1R                           5
BIT_P2B                           5
BIT_P2G                           4
BIT_P2R                           0
BIT_P3B                           1
BIT_P3G                           2
BIT_P3R                           3
BRG0                              00000000
BRG1                              00000001
BRG10                             00000002
BRG11                             00000003
BRG12                             00000004
BRG13                             00000005
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 34


SYMBOL TABLE
  LABEL                             VALUE 

BRG14                             00000006
BRG15                             00000007
BRG16                             00000003
BRG2                              00000002
BRG3                              00000003
BRG4                              00000004
BRG5                              00000005
BRG6                              00000006
BRG7                              00000007
BRG8                              00000000
BRG9                              00000001
BRGH                              00000002
C                                 00000000
C1CH0                             00000000
C1CH1                             00000001
C1IE                              00000005
C1IF                              00000005
C1OE                              00000005
C1ON                              00000007
C1OUT                             00000006
C1POL                             00000004
C1R                               00000002
C1RSEL                            00000005
C1SEN                             00000005
C2CH0                             00000000
C2CH1                             00000001
C2IE                              00000006
C2IF                              00000006
C2OE                              00000005
C2ON                              00000007
C2OUT                             00000006
C2POL                             00000004
C2R                               00000002
C2REN                             00000004
C2RSEL                            00000004
C2SYNC                            00000000
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 35


SYMBOL TABLE
  LABEL                             VALUE 

CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CKE                               00000006
CKP                               00000004
CM1CON0                           00000107
CM2CON0                           00000108
CM2CON1                           00000109
CREN                              00000004
CSRC                              00000007
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DIS_GLOBAL_IT                     bcf     INTCON,GIE
DIS_PERIPH_IT                     bcf     INTCON,PEIE
D_A                               00000005
D_NOT_A                           00000005
ECCPAS                            0000009C
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDAT                             0000010C
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
EE_Read_Data                      000001CE
EE_VERSION_ADDR                   00002100
EN_GLOBAL_IT                      bsf     INTCON,GIE
EN_PERIPH_IT                      bsf     INTCON,PEIE
F                                 00000001
FERR                              00000002
FSR                               00000004
FVREN                             00000000
GCEN                              00000007
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 36


SYMBOL TABLE
  LABEL                             VALUE 

GIE                               00000007
GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
HTS                               00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOCB                              00000096
IOCB0                             00000000
IOCB1                             00000001
IOCB2                             00000002
IOCB3                             00000003
IOCB4                             00000004
IOCB5                             00000005
IOCB6                             00000006
IOCB7                             00000007
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
ISR                               00000004
IT_USART                          00000018
Init_PWM_Control                  00000037
LTS                               00000001
MC1OUT                            00000007
MC2OUT                            00000006
MSK                               00000093
MSK0                              00000000
MSK1                              00000001
MSK2                              00000002
MSK3                              00000003
MSK4                              00000004
MSK5                              00000005
MSK6                              00000006
MSK7                              00000007
Main_Loop                         000001B9
Main_Loop_end                     000001C9
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 37


SYMBOL TABLE
  LABEL                             VALUE 

NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OERR                              00000001
OPTION_REG                        00000081
OPTION_REG_INIT                   00000000
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
P                                 00000004
P1M0                              00000006
P1M1                              00000007
PCL                               00000002
PCLATH                            0000000A
PCLATH_Save                       00000072
PCON                              0000008E
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTE                             00000009
PORT_P0B                          PORTA
PORT_P0G                          PORTA
PORT_P0R                          PORTA
PORT_P1B                          PORTA
PORT_P1G                          PORTA
PORT_P1R                          PORTA
PORT_P2B                          PORTC
PORT_P2G                          PORTC
PORT_P2R                          PORTC
PORT_P3B                          PORTC
PORT_P3G                          PORTC
PORT_P3R                          PORTC
PR2                               00000092
PRSEN                             00000007
PS0                               00000000
PS1                               00000001
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 38


SYMBOL TABLE
  LABEL                             VALUE 

PS2                               00000002
PSA                               00000003
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PSTRCON                           0000009D
PULSR                             00000002
PULSS                             00000003
PWM1CON                           0000009B
PWM_Control                       00000072
PWM_SHIFT                         00000010
PWM_Szin_Table                    00000025
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RAM_B0_BEG                        00000020
RAM_B0_END                        0000006F
RAM_B1_BEG                        000000A0
RAM_B1_END                        000000BF
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIDL                             00000006
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 39


SYMBOL TABLE
  LABEL                             VALUE 

RCSTA_INIT                        00000090
RD                                00000000
RE3                               00000003
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
RX_TMP                            00000023
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SBOREN                            00000004
SCKP                              00000004
SCS                               00000000
SEN                               00000000
SENDB                             00000003
SMP                               00000007
SPBRG                             00000099
SPBRGH                            0000009A
SPBRGH_INIT                       00000000
SPBRG_INIT                        0000001F
SPEN                              00000007
SR0                               00000006
SR1                               00000007
SRCON                             00000185
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPMSK                            00000093
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
STATUS_Save                       00000071
STRA                              00000000
STRB                              00000001
STRC                              00000002
STRD                              00000003
STRSYNC                           00000004
SUB16                             
SWDTEN                            00000000
SYNC                              00000004
SYSTEM_TIMER_10MS_INIT            0000009C
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 40


SYMBOL TABLE
  LABEL                             VALUE 

Start_Reset                       00000196
SystemTimer10ms                   00000020
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GINV                            00000007
T1GIV                             00000007
T1GSS                             00000001
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TIMER0_CYCLE                      00000100
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR0_INIT                         00000088
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TMR_DEC                           
TMR_DEC_FSR                       
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 41


SYMBOL TABLE
  LABEL                             VALUE 

TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISE                             00000089
TRISE3                            00000003
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
TXSTA_INIT                        00000024
UA                                00000001
ULPWUE                            00000005
ULPWUIE                           00000002
ULPWUIF                           00000002
USART_CONFIG_MARKER               0000000E
USART_INIT_MARKER                 000000F0
USART_Init                        000000E0
USART_Mode_0                      0000011D
USART_Mode_1                      00000125
USART_Mode_1_Fenyero              00000132
USART_Mode_1_ToConfig             0000012E
USART_Mode_2                      00000143
USART_Mode_2_To1                  00000154
USART_Mode_2_UPWMI_cycle          0000015A
USART_Mode_2_UpdatePWMIntervals   00000158
USART_RX_ACK_MARKER               000000F5
USART_Recv                        00000102
USART_Recv_Modes                  0000010F
USART_TX_ACK_BASE                 00000041
USART_Task                        0000016E
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 42


SYMBOL TABLE
  LABEL                             VALUE 

USART_Task_Ack                    00000191
USART_Task_Ver                    00000175
USART_Task_Ver1                   0000017B
USART_Task_Ver2                   00000182
USART_Task_Ver3                   00000189
VCFG0                             00000004
VCFG1                             00000005
VERSION_TEXT_1                    00000076
VERSION_TEXT_2                    00000031
VERSION_TEXT_3                    0000002E
VERSION_TEXT_4                    00000030
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000097
VREN                              00000007
VROE                              00000006
VRR                               00000005
VRSS                              00000004
W                                 00000000
WCOL                              00000007
WDTCON                            00000105
WDTCON_INIT                       00000015
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPUB                              00000095
WPUB0                             00000000
WPUB1                             00000001
WPUB2                             00000002
WPUB3                             00000003
WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WUE                               00000001
W_Save                            00000070
Z                                 00000002
_BOR21V                           00003EFF
_BOR40V                           00003FFF
_BOR4V_BOR21V                     00003EFF
_BOR4V_BOR40V                     00003FFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
_BOR_NSLEEP                       00003EFF
_BOR_OFF                          00003CFF
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 43


SYMBOL TABLE
  LABEL                             VALUE 

_BOR_ON                           00003FFF
_BOR_SBODEN                       00003DFF
_CONFIG1                          00002007
_CONFIG2                          00002008
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         00001FFF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRC_CLKOUT                00003FFF
_FOSC_EXTRC_NOCLKOUT              00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTRC_CLKOUT                00003FFD
_FOSC_INTRC_NOCLKOUT              00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_HS_OSC                           00003FFA
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_LVP_OFF                          00002FFF
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_RAM_B0                           0000005D
_RAM_B1                           000000A0
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 44


SYMBOL TABLE
  LABEL                             VALUE 

_XT_OSC                           00003FF9
__16F882                          00000001
__DEBUG                           1
array                             
bank0                             
bank1                             
bank2                             
bank3                             
byte                              
fenyero                           00000043
fenyero_3bit                      0000004F
fenyero_szin                      00000029
i                                 00000021
i_Save                            00000073
j                                 00000022
j_Save                            00000074
pwm_cnt                           0000005B
pwm_cnt_shift                     0000005C
sc                                btfss   STATUS,C
snc                               btfsc   STATUS,C
snz                               btfsc   STATUS,Z
sz                                btfss   STATUS,Z
szint_b                           0000003B
szint_g                           00000033
szint_r                           0000002B
tstw                              xorlw   0
usart_rx_fenyero                  00000026
usart_rx_fenyero_tmp              00000027
usart_rx_id                       00000025
usart_rx_mode                     00000024
usart_rx_ph_cnt                   00000028
usart_sendAck                     usart_status,1
usart_sendVersion                 usart_status,0
usart_status                      0000002A
word                              


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XXX-XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM  5.51                          MAIN.ASM   7-31-2018  15:30:19         PAGE 45


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXX----- ---------------- ----------------
2100 : XXXX------------ ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   474
Program Memory Words Free:  1574


Errors   :     0
Warnings :     0 reported,    18 suppressed
Messages :    17 reported,     0 suppressed

